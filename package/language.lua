-- I apologize in advance for this:

local sample_text = [[
SO HELLO, I AM WRITING ABSOLUTE NOOONSENSE TO FEED MY CRAPPY MARKOV ALGORITHM FOR CREATING RANDOM STUFF FOR MY GAME.
SAMPLE TEXT IS THE BEST, I LOVE SAMPLE TEXT, THERE IS SO MUCH TO BE SAID EXCEPT LUREM IPSUM DOLOR SIT AMET.
I HOPE MY FRIENDS KNOW ME BETTER AFTER THIS, THERE'S JUST SO MUCH MINECRAFT UNDERTALE MOMENTS TO BE GLOSSED OVER, HEH! HEY!!
WHERE IS MY CUPPA COFFEE, MY CUP OF COFFEE IS GREAT, COFFEE IS AWESOME, I LOVE COFFEE BECAUSE COFFE MADE MY MOM CRY.
GOD, I DONT EVEN KNOW WHAT I AM SAYING, PLEASE HELP ME LMAOOO, HEY, HEY HEY, BRAIN ROT! BRAIN ROT!
I LOVE EXISTING AND I LOVE TALKING AND I LOVE SAYING STUFF, AND I EXIST HELLO!
WILL YOU MARRY ME? WILL YOU LOVE ME? I DON'T KNOW! I REALLY DONT!

HERE ARE SOME EXAMPLES ON HOW TO USE THE WORD LOVE:
I LOVE YOU,
I LOVE CHEESE,
LOVE IS FOR THE LOVERS,
GOOD LOVE IS LOVE FOR THE GOOD,
FEED THE MARKOV, OH LOVERS, OH GOATS!

HONESTLY IT'S A BIT TRICKY TO WRITE THIS MUCH NONSENSE BUT I CANT BEGIN TO IMAGINE THE KIND OF NONSENSE THAT STUFF
OPENAI USES, AT LEAST I'M NOT DOING ANYTHING UNETHICAL LIKE FEEDING HUMAN-MADE CONTENT FOR LOVE INTO THE SOULLESS PIT THAT IS
AI! ISNT IT GREEEAT?

YOU NEED TO BE COOL AS FRICK, RIGHT? YOU NEED TO BE GREAT ENOUGH TO READ A MILLION TRILLION BARGILLION BOOKS UNTIL YOU
CAN STOP A TRAIN WITH YOUR ASSSSSSSSS, STOP WITH THE MAGIC!

SO A LOT OF COMPANIES ARE INVESTING IN AI, I THINK AI SUCKS BALLS SO I AM GONNA PATENT MY NEWEST INVENTION: THE N.S.G.A,
THE N___STIC SENTENCE GENERATOR ALGORITHM, IT'S SUPERIOR, IT'S BETTER THAN CHATGPT BECAUSE THIS ACTUALLY FULFILLS IT'S
PURPOSE INSTEAD OF FOOLING PEOPLE IT KNOWS ANYTHING AT ALL, BECAUSE AI IS NOT INTELLIGENT, REMEMBER THAT CRAP, BRUV!

MARKOV IS LOVE, MARKOV IS GREAT, MARKOV IS WHEN YOU ARE THE THING THAT WORKS, THE THING THAT WILL CHANGE THE WORLD FOREVER,
GOOD NIGHT FRIENDS! GOOD NIGHT.

AS I AM ALREADY RUNNING DRY, I AM GOING TO START TALKING ABOUT THINGS I THINK ARE COOL, AND RAMBLE A BIT HERE.

THE FEDIVERSE, FOR ME, IS THE NEXT FRONTIER OF DIGITAL COMMUNICATION WHERE YOU ARE ABLE TO DEVELOP A SYSTEM WHERE
YOU HAVE A BUNCH OF DECENTRALIZED, CONTROLLED NODES WHICH AT THE SAME TIME RESPECT THE AUTORITY OF THE USER THROUGH
DEMOCRATIC SYSTEMS.

THANKFULLY, THE ACTIVITYPUB PROTOCOL IS ACTUALLY VERY EFFICIENT AND FLEXIBLE, SO IN THEORY YOU COULD EFFECTIVELY
DEMOCRATIZE ALMOST EVERY FORM OF COMMUNICATION IN THE INTERNET, IN A WAY THAT BOTH BENEFITS INFRASTRUCTURAL NEEDS
AND USER NEEDS, IT IS GREAT THAT THIS PROTOCOL EXISTS.

THERE'S A LOT OF STUFF TO BE SAID ABOUT HOW WE HANDLE SOCIAL MEDIA TODAY, AND I FEEL LIKE THERE'S SO MUCH TO BE DONE ABOUT IT,
I ALSO FEEL LIKE WE, AS SOCIAL ANIMALS, SHOULDN'T BE ATTACHED TO MEGACORPORATIONS MAKING MONEY OFF OUR BARE EXISTENCE THROUGH
THE PRIVATIZATION AND MONOPOLY ON SUCH HUMAN NEEDS, SUCH AS THE NEED OF COMMUNICATION, THE NEED OF SAFETY, THE NEED OF BEING
PART OF SOMETHING, THE NEED OF BEING CONNECTED. 

THERE'S NOT MUCH STUFF THAT I CAN SAY THAT ARE EFFECTIVELY WORSE THAN STRIPPING SOMEONE OF IT'S PRIMAL NEEDS, MUCH LESS
TURN IT INTO A ONE-WAY SYSTEM WHERE ALL THE POWER IS STRIPPED FROM US, SO WE GET FED A BUNCH OF CRAP, A BUNCH OF LOW QUALITY
BULLSTUFF GENERATED BY SOULLESS ALGORITHMS ENGINEERED TO STEAL BACK FROM US, LIKE OUROBOUROS CREATING THE MOST STUPID,
MINDLESS CONTENT, OR WORSE, SHAPING OUR MINDS AND THUS, THE ART THAT WE CREATE, TO FIT THIS MEAN OF CONSUMPTION.

TO BE AN ARTIST IS TO DIE TRYING.

THEY HAVE FIGURED OUT HOW TO COLONIZE OUR MINDS, TO STEAL OUR RESOURCES, TO STRIP US FROM ALL THAT MAKES US HUMAN, OF ALL 
THAT FILLS US WITH JOY IF IT'S NOT TO MAKE THEM RICHER AND MORE POWERFUL.

THIS WORLD TRIES TO TEACH US THAT OUR FUNCTION IS TO CONSUME, TO MAKE US THINK THAT CREATING IS SOMEHOW A WASTE OF TIME,
THAT'S WHY THERE'S SO MUCH "AI ART", BECAUSE PEOPLE ARE HELLBENT ON THE OUTPUT, NOT THE ACTUAL PROCESS OF CREATIONSHIP.

WE LOVE, WE CRY, WE END.

SO, IF YOU ARE READING, PLEASE, CONSIDER MOVING OUT FROM PLATFORMS LIKE THESE, CONSIDER TO BUY LOCAL STUFF ONLY, CONSIDER
TO STOP GOING TO STARBUCKS, GET MAD! GET ANGRY! FIGHT FOR THE INDEPENDENCE OF HUMAN THOUGHT! FIGHT FOR THE DECAYING SOULS
OF THE LONELY, GO OUT AND CONSUME INDEPENDENT CONTENT, HELP INDEPENDENT CREATORS, OUR ONLY HOPE IS IN LOVE. 

DO YOU REALLY LIKE CHEESE? OR ARE YOU JUST A CHEESE POSER? ARE YOU HAPPIER OR SADDER?

I REALLY LIKE 20SYL'S MUSIC, IT'S REALLY GOOD, 20SYL'S PRODUCTION IS NEXT LEVEL.
I ALSO REALLY THINK KENDRICK WON THE BEEF, BUT THAT'S NOT AN UNPOPULAR OPINION.
KENNY DISSOLVED THAT CANADIAN DRIZZY.

PUNK ASS MOFO, ALL POWER, NO GAIN!

SUGAR IS SWEET, YOU ARE THE BEST, I LOVE YOU A LOT, YOU ARE VERY COOL!
SUNGAZER IS MY FAVE JAZZ BAND, I ALSO LOVE THE WAY SUNGAZER MAKES MUSIC!

KNEIL!

FUN IS THE THING THAT KEEPS US LIVING, ISN'T IT?
IT'S ALL FOR FUN AND LOVE

THE VESSEL AS FOR WHICH WE FIGHT AND POUR OUR LOVE INTO.
THE VESSEL WE USE FOR FINDING OURSELVES.
THE VESSEL I MADE, FOR FUN.

I MADE YOU SPECIAL.
I MADE YOU AS A VESSEL FOR FUN.
]]

-- Function to split text into words
local function split_text(text)
    local words = {}
    for word in text:gmatch("%S+") do
        table.insert(words, word)
    end
    return words
end

-- Function to build a Markov chain from the sample text
local function build_markov_chain(text)
    local words = split_text(text)
    local markov_chain = {}
    
    for i = 1, #words - 1 do
        local current_word = words[i]
        local next_word = words[i + 1]
        
        if not markov_chain[current_word] then
            markov_chain[current_word] = {}
        end
        
        table.insert(markov_chain[current_word], next_word)
    end
    
    return markov_chain
end

-- Function to generate a random sentence using the Markov chain
local function generate_sentence(markov_chain, starting_word, max_words)
    local current_word = starting_word:match("%S+$") -- Starting word
    local sentence = starting_word
    
    for _ = 1, max_words do
        local next_words = markov_chain[current_word]
        
        if next_words then
            local next_word_index = math.random(1, #next_words)
            local next_word = next_words[next_word_index]
            sentence = sentence .. " " .. next_word
            current_word = next_word
        else
            break
        end
    end
    
    return sentence
end

local function split_into_syllables(word)
    local vowels = "aeiouAEIOU"
    local syllables = {}
    local current_syllable = ""

    local function is_vowel(char)
        return string.find(vowels, char, 1, true) ~= nil
    end

    local function end_syllable()
        if current_syllable ~= "" then
            local past = syllables[#syllables]
            if past and (#past == 1 or #current_syllable < 2) then
                syllables[#syllables] = past .. current_syllable
                current_syllable = ""
                return
            end
            table.insert(syllables, current_syllable)
            current_syllable = ""
        end

    end

    for i = 1, #word do
        local char = string.sub(word, i, i)

        if is_vowel(string.sub(word, i+1, i+1)) or char == " " then
            end_syllable()
            current_syllable = char
        else
            current_syllable = current_syllable .. char
        end
    end

    end_syllable()

    return syllables
end

-- Example usage
local markov_chain = build_markov_chain(sample_text)

return {
    markov = function (start, words)
        return generate_sentence(markov_chain, start, words)
    end,
    
    syllabify = split_into_syllables
}